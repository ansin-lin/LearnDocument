
# ç¬¬8ç«  é¢å‘å¯¹è±¡ï¼ˆOOPï¼‰

> ğŸ”‘ ç›®æ ‡ï¼šæŒæ¡å°è£… / ç»§æ‰¿ / å¤šæ€ / ç»„åˆç­‰æ ¸å¿ƒï¼Œä»¥åŠå±æ€§ç®¡ç†ã€ä¸‰ç±»æ–¹æ³•ã€é­”æœ¯æ–¹æ³•ã€æ•°æ®ç±»ä¸åè®®ã€å®æˆ˜æ¨¡å¼ã€‚

---

## ä¸ºä»€ä¹ˆéœ€è¦é¢å‘å¯¹è±¡ï¼Ÿ

- **è¿‡ç¨‹å¼**ï¼šæŠŠæ­¥éª¤å†™æˆå‡½æ•°ï¼Œæ•°æ®ä¸æ“ä½œåˆ†æ•£ï¼Œä¸åŒåœ°æ–¹å®¹æ˜“â€œæ•£æ¶â€ã€‚  
- **é¢å‘å¯¹è±¡**ï¼šæŠŠæ•°æ®ï¼ˆçŠ¶æ€ï¼‰å’Œæ“ä½œï¼ˆè¡Œä¸ºï¼‰**è£…åˆ°å¯¹è±¡é‡Œ**ï¼Œå¯¹è±¡å¯¹å¤–æä¾›æ–¹æ³•ï¼ˆæ¥å£ï¼‰ï¼Œå†…éƒ¨ç»†èŠ‚å¯æ”¹å˜ä½†å¤–éƒ¨è°ƒç”¨æ–¹å¼å°½é‡ä¸å˜ã€‚  
- ç»“æœï¼šæ›´**å¥½ç»´æŠ¤**ï¼ˆå±€éƒ¨å˜åŒ–ä¸å½±å“å…¨å±€ï¼‰ã€æ›´**å¯å¤ç”¨**ï¼ˆå¯¹è±¡å¯ç»„åˆï¼‰ã€æ›´**è´´è¿‘ä¸šåŠ¡**ï¼ˆäºº-è½¦-è®¢å•ç­‰â€œåè¯å³å¯¹è±¡â€ï¼‰ã€‚

## 1 OOP æ ¸å¿ƒæ€æƒ³ä¸æœ¯è¯­

1. å°è£…ï¼ˆEncapsulationï¼‰
    - æŠŠæ•°æ®ï¼ˆçŠ¶æ€ï¼‰ä¸æ“ä½œï¼ˆè¡Œä¸ºï¼‰å°è£…è¿›å¯¹è±¡å†…éƒ¨ï¼Œå¯¹å¤–æä¾›å—æ§æ¥å£ã€‚
    - ç›®çš„ï¼šéšè—å®ç°ç»†èŠ‚ã€é™ä½è€¦åˆã€ä¿æŠ¤ä¸å˜é‡ã€ä¾¿äºæ¼”è¿›ä¸æµ‹è¯•ã€‚

2. ç»§æ‰¿ï¼ˆInheritanceï¼‰
    - å­ç±»è·å¾—çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œå®ç°ä»£ç å¤ç”¨ä¸è¡Œä¸ºæ‰©å±•ã€‚

3. å¤šæ€ï¼ˆPolymorphismï¼‰
    - åŒä¸€æ¥å£ï¼Œé’ˆå¯¹ä¸åŒå¯¹è±¡å‘ˆç°å‡ºä¸åŒçš„å®ç°ï¼ˆæ–¹æ³•åŒåï¼Œä¸åŒè¡Œä¸ºï¼‰ã€‚
    - Python æ›´å¼ºè°ƒâ€œé¸­å­ç±»å‹â€ï¼šåªè¦â€œåƒé¸­å­ä¸€æ ·å«â€ï¼Œå°±å½“å®ƒæ˜¯é¸­å­ã€‚

4. ç»„åˆï¼ˆCompositionï¼‰
    - ç”¨â€œå¯¹è±¡åŒ…å«å¯¹è±¡â€çš„æ–¹å¼å¤ç”¨ä¸æ‹¼è£…èƒ½åŠ›ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ä¼˜äºâ€œç»§æ‰¿å±‚çº§è¶Šæ¥è¶Šæ·±â€ã€‚

---

## 2 ç±»ä¸å¯¹è±¡

- **ç±»**ï¼šè“å›¾/æ¨¡æ¿ï¼Œæè¿°â€œè¿™ç±»å¯¹è±¡â€åº”è¯¥æ‹¥æœ‰å“ªäº›å±æ€§ï¼ˆæ•°æ®ï¼‰å’Œæ–¹æ³•ï¼ˆè¡Œä¸ºï¼‰ã€‚  
- **å¯¹è±¡**ï¼šæ ¹æ®ç±»åˆ›å»ºå‡ºæ¥çš„â€œçœŸå®ä¸ªä½“â€ï¼Œæ¯ä¸ªå¯¹è±¡æœ‰è‡ªå·±çš„**ç‹¬ç«‹çŠ¶æ€**ã€‚

```python
class Person:
    # __init__ æ˜¯â€œæ„é€ æ–¹æ³•â€ï¼Œåœ¨åˆ›å»ºå¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨
    def __init__(self, name, age):
        self.name = name      # ç»™â€œå½“å‰å¯¹è±¡(self)â€ç»‘å®šå±æ€§
        self.age = age

    # å®ä¾‹æ–¹æ³•ï¼šæè¿°å¯¹è±¡çš„è¡Œä¸ºï¼Œç¬¬ä¸€ä¸ªå‚æ•°çº¦å®šåä¸º selfï¼ˆè¡¨ç¤ºå½“å‰å¯¹è±¡ï¼‰
    def introduce(self):
        return f"æˆ‘å« {self.name}ï¼Œä»Šå¹´ {self.age} å²ã€‚"

# === è°ƒç”¨æ¼”ç¤º ===
p = Person("Alice", 25)          # åˆ›å»ºå¯¹è±¡ï¼ˆå®ä¾‹åŒ–ï¼‰
print(p.name, p.age)             # è®¿é—®å®ä¾‹å±æ€§ -> Alice 25
print(p.introduce())             # è°ƒç”¨å®ä¾‹æ–¹æ³• -> æˆ‘å« Aliceï¼Œä»Šå¹´ 25 å²ã€‚
```

- `self`ï¼šå®ä¾‹æ–¹æ³•é¦–å‚çš„**çº¦å®šå**ï¼ˆè§£é‡Šå™¨ä¼ å…¥ï¼‰ã€‚  
- æ„é€ æ—¶è¿›è¡Œ**æ ¡éªŒ/å»ºä¸å˜é‡/æ³¨å…¥ä¾èµ–**ã€‚

---

## 3 å®ä¾‹å±æ€§ vs ç±»å±æ€§

- **å®ä¾‹å±æ€§**ï¼šå†™åœ¨ `self.xxx = ...`ï¼Œ**æ¯ä¸ªå¯¹è±¡ç‹¬ç«‹**ã€‚  
- **ç±»å±æ€§**ï¼šç›´æ¥å†™åœ¨ç±»ä½“å†…ï¼ˆä¸åœ¨æ–¹æ³•ä¸­ï¼‰ï¼Œ**æ‰€æœ‰å¯¹è±¡å…±äº«**ã€‚

```python
class Student:
    school = "CS"  # ç±»å±æ€§ï¼ˆå…±äº«ï¼‰
    def __init__(self, name):
        self.name = name  # å®ä¾‹å±æ€§ï¼ˆç‹¬ç«‹ï¼‰

a, b = Student("Tom"), Student("Ann")
Student.school = "AI"
print(a.school, b.school)  # AI AI
```

!!! warning "é¿å‘"
    - åœ¨**å®ä¾‹**ä¸Šå†™åŒåå±æ€§ä¼š**é®è”½**ç±»å±æ€§ï¼Œä»…å¯¹è¯¥å®ä¾‹ç”Ÿæ•ˆã€‚  
    - æƒ³çœŸæ­£ä¿®æ”¹ç±»å±æ€§ï¼Œè¯·ç”¨ `Class.attr = ...` æˆ–åœ¨ç±»æ–¹æ³•(`@classmethod`)é‡Œç”¨ `cls.attr = ...`ã€‚

---

## 4 å®ä¾‹ / ç±» / é™æ€æ–¹æ³•

### **ä¸€å±å¯¹æ¯”**

| æ–¹æ³•ç±»å‹ | ç»‘å®šå¯¹è±¡ | é¦–å‚ | è®¿é—®å®ä¾‹çŠ¶æ€ | è®¿é—®ç±»çŠ¶æ€ | å¸¸è§ç”¨é€” | å…¸å‹è°ƒç”¨ |
|---|---|---|---|---|---|---|
| å®ä¾‹æ–¹æ³• | å®ä¾‹ | `self` | âœ… | å¯ç» `self.__class__` é—´æ¥è®¿é—® | è¯»/æ”¹å®ä¾‹å­—æ®µï¼Œä¸šåŠ¡è¡Œä¸º | `obj.m(...)` |
| ç±»æ–¹æ³• | ç±» | `cls` | âŒ | âœ… | å¤‡ç”¨æ„é€ ã€ç±»çº§é…ç½®/è®¡æ•°å™¨ã€å·¥å‚ | `Cls.m(...)` / `obj.m(...)` |
| é™æ€æ–¹æ³• | æ—  | æ—  | âŒ | âŒ | ä¸ç±»è¯­ä¹‰ç›¸å…³ä¸”ä¸ä¾èµ–çŠ¶æ€çš„çº¯å·¥å…· | `Cls.m(...)` / `obj.m(...)` |

### **å®ä¾‹æ–¹æ³•ï¼ˆéœ€è¦ selfï¼‰**

- **ä½œç”¨**ï¼šæ“ä½œæŸä¸ªå®ä¾‹çš„çŠ¶æ€ï¼ˆè¯»/æ”¹ `self.xxx`ï¼‰ã€‚
- **å®šä¹‰**ï¼šé¦–å‚ä¸º `self`ï¼ˆçº¦å®šï¼‰ã€‚
- **è°ƒç”¨**ï¼š`obj.m(...)`ï¼ˆè§£é‡Šå™¨è‡ªåŠ¨æŠŠ `self=obj` ç»‘å®šï¼‰ã€‚

```python
class Counter:
    def __init__(self, start=0):
        self.value = start
    def inc(self, step=1):
        self.value += step
        return self.value

c = Counter(10)
print(c.inc())        # 11
print(Counter.inc(c)) # ç­‰ä»·å†™æ³•ï¼ˆæ¼”ç¤ºç»‘å®šåŸç†ï¼‰
```

### **ç±»æ–¹æ³•**

- **ä½œç”¨**ï¼šæ“ä½œç±»çº§çŠ¶æ€æˆ–äº§å‡ºå®ä¾‹ï¼ˆå·¥å‚/å¤‡ç”¨æ„é€ å™¨ï¼‰ã€‚
- **å®šä¹‰**ï¼š`@classmethod` ä¿®é¥°ï¼Œé¦–å‚ä¸º `cls`ï¼ˆå½“å‰ç±»å¯¹è±¡ï¼‰ã€‚
- **è°ƒç”¨**ï¼š`Cls.m(...)` æˆ– `obj.m(...)`ï¼ˆéƒ½ä¼šæŠŠæ‰€å±ç±»ç»‘å®šä¸º `cls`ï¼‰ã€‚

```python
class App:
    _version = "1.0"
    def __init__(self, name):
        self.name = name
    @classmethod
    def set_version(cls, v):
        cls._version = v
    @classmethod
    def from_env(cls):
        return cls("from_env")
```

### **é™æ€æ–¹æ³•**

- **ä½œç”¨**ï¼šä¸ç±»è¯­ä¹‰ç›¸å…³ä½†ä¸ä¾èµ–ä»»ä½•çŠ¶æ€çš„çº¯å·¥å…·å‡½æ•°ã€‚
- **å®šä¹‰**ï¼š`@staticmethod` ä¿®é¥°ï¼Œæ—  `self/cls`ã€‚
- **è°ƒç”¨**ï¼š`Cls.m(...)` æˆ– `obj.m(...)`ã€‚

```python
class Math:
    @staticmethod
    def add(a, b):
        return a + b
```

### **é€‰æ‹©æŒ‡å—ï¼ˆå†³ç­–æ ‘ï¼‰**

- è¯»/æ”¹ **å®ä¾‹æ•°æ®** â†’ å®ä¾‹æ–¹æ³•
- è¯»/æ”¹ **ç±»çº§æ•°æ®** æˆ–è¿”å› **æœ¬ç±»/å­ç±»å®ä¾‹** â†’ ç±»æ–¹æ³•
- ä¸ç±»ç›¸å…³ä½† **ä¸ä¾èµ–çŠ¶æ€** â†’ é™æ€æ–¹æ³•ï¼ˆæˆ–æ”¾æ¨¡å—çº§ï¼‰

### **å¸¸è§å‘**

- åœ¨å®ä¾‹ä¸Šå†™åŒåå±æ€§ä¼šé®è”½ç±»å±æ€§;çœŸæ­£è¦æ”¹ç±»å±æ€§ç”¨ `Class.attr` æˆ–åœ¨ `@classmethod` é‡Œ `cls.attr`ã€‚
- æ»¥ç”¨ `@staticmethod`ï¼šè‹¥ä¸ç±»å…³ç³»ä¸å¼ºï¼Œåº”æ”¾æ¨¡å—çº§å‡½æ•°ã€‚
- å¤šæ€æ„é€ é”™ç”¨é™æ€æ–¹æ³•ï¼šåº”ä½¿ç”¨ `@classmethod`ï¼Œè®© `cls` æŒ‡å‘å®é™…å­ç±»ã€‚
- è¯¯ä»¥ä¸ºç±»æ–¹æ³•èƒ½ç›´æ¥è®¿é—®å®ä¾‹ï¼šç±»æ–¹æ³•æ²¡æœ‰ `self`ã€‚

### **ç»¼åˆå¯¹ç…§**

```python
class Demo:
    kind = "tool"
    def __init__(self, name):
        self.name = name
    def who_am_i(self):
        return f"{self.name} ({self.kind})"
    @classmethod
    def change_kind(cls, k):
        cls.kind = k
    @classmethod
    def from_upper(cls, name):
        return cls(name.upper())
    @staticmethod
    def valid_name(s):
        return isinstance(s, str) and s.strip() != ""
```

## 5 å°è£…ä¸å±æ€§ç®¡ç†

### 5.1 å¯è§æ€§çº¦å®š

- publicï¼šä¸ä»¥ä¸‹åˆ’çº¿å¼€å¤´ï¼Œå¯¹å¤–å¯è®¿é—®ã€‚
- _protectedï¼šå•ä¸‹åˆ’çº¿ï¼Œè¡¨ç¤ºâ€œå†…éƒ¨ä½¿ç”¨â€ï¼Œçº¦å®šå¤–éƒ¨ä¸ç›´æ¥è®¿é—®ã€‚
- __privateï¼šåŒä¸‹åˆ’çº¿ï¼Œè§¦å‘åç§°é‡æ•´ï¼Œé¿å…å­ç±»æ— æ„è¦†ç›–ï¼ˆä¸æ˜¯ç»å¯¹å®‰å…¨ï¼Œä»…æ¸©å’Œä¿æŠ¤ï¼‰ã€‚

```python
class Box:
    def __init__(self):
        self.pub = 1; self._inner = 2; self.__secret = 3
print(Box()._Box__secret)  # åç§°é‡æ•´è®¿é—®
```

### 5.2 `@property`ï¼ˆå—æ§å±æ€§ï¼Œé¦–é€‰ï¼‰

æŠŠæ–¹æ³•â€œä¼ªè£…æˆå±æ€§â€ï¼ˆå—æ§è¯»å†™/åªè¯»/æ´¾ç”Ÿå€¼ï¼‰

- é€‚åˆåš**æ ¡éªŒ**ã€**åªè¯»æ´¾ç”Ÿ**ï¼ˆå¦‚æ‘„æ°â†”åæ°ï¼‰ã€**ä¿æŒ API ç®€æ´**ã€‚

```python
class Celsius:
    def __init__(self, c):
        self._c = float(c)            # çº¦å®šå†…éƒ¨å­˜æ”¾ç”¨ _c

    @property
    def celsius(self):                # è¯»å±æ€§ celsiusï¼ˆä¸åŠ æ‹¬å·ï¼‰
        return self._c

    @celsius.setter
    def celsius(self, v):             # å†™å±æ€§ celsius æ—¶è§¦å‘æ ¡éªŒ
        v = float(v)
        if v < -273.15:
            raise ValueError("ä½äºç»å¯¹é›¶åº¦")
        self._c = v

    @property
    def fahrenheit(self):             # åªè¯»æ´¾ç”Ÿå±æ€§
        return self._c * 9/5 + 32

# === è°ƒç”¨æ¼”ç¤º ===
t = Celsius(0)
print(t.celsius, t.fahrenheit)  # -> 0.0 32.0
t.celsius = 100
print(t.celsius, t.fahrenheit)  # -> 100.0 212.0
```

### 5.3 è®¿é—®æ‹¦æˆªä¸æè¿°ç¬¦

- `__getattr__(self, name)`ï¼š**å¸¸è§„æ‰¾ä¸åˆ°å±æ€§æ—¶**æ‰è°ƒç”¨ï¼Œé€‚åˆâ€œæ‡’åŠ è½½/ä»£ç†/é»˜è®¤å€¼â€ã€‚  
- `__getattribute__(self, name)`ï¼š**æ¯æ¬¡è®¿é—®**éƒ½è°ƒç”¨ï¼Œå¨åŠ›å¤§ä¸”å±é™©ï¼Œè¯·è°¨æ…ã€‚  
- `__setattr__(self, name, value)`ï¼šæ‹¦æˆª**æ‰€æœ‰å±æ€§å†™å…¥**ï¼Œå¯åšå®¡è®¡/å†»ç»“ã€‚

è¿™ä¸‰ä¸ªæ–¹æ³•å±äº â€œå±æ€§è®¿é—®æ‹¦æˆªå™¨â€ï¼Œä¹Ÿå« â€œé­”æ³•æ–¹æ³•ï¼ˆMagic Methodsï¼‰â€ã€‚
Python ä¸­å‡ ä¹ä¸€åˆ‡è®¿é—® obj.xxx çš„è¡Œä¸ºï¼Œéƒ½ä¼šç»è¿‡å®ƒä»¬ã€‚

å¯ä»¥ç†è§£ä¸ºï¼š

- å¹³å¸¸è®¿é—®å±æ€§åƒâ€œèµ°æ­£é—¨â€ï¼Œ
- è¿™ä¸‰ä¸ªæ–¹æ³•æ˜¯â€œåœ¨é—¨å£åŠ ä¿å®‰â€ï¼Œ
- ä½ å¯ä»¥åœ¨ä»»ä½•è®¿é—®æˆ–èµ‹å€¼å‘ç”Ÿæ—¶æ’å…¥è‡ªå·±çš„é€»è¾‘ã€‚

- ä¸‰è€…çš„åŒºåˆ«ä¸ä½œç”¨åœºæ™¯

| æ–¹æ³•å                              | è§¦å‘æ—¶æœº        | ç”¨æ¥å¹²å˜›                    | å…¸å‹åœºæ™¯         |
| :------------------------------- | :---------- | :---------------------- | :----------- |
| `__getattr__(self, name)`        | è®¿é—®ä¸å­˜åœ¨çš„å±æ€§æ—¶è§¦å‘ | ç»™**ä¸å­˜åœ¨çš„å±æ€§**ä¸€ä¸ªé»˜è®¤å€¼ã€æ‡’åŠ è½½æˆ–å®¹é”™ | â€œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¸´æ—¶ç”Ÿæˆâ€ |
| `__getattribute__(self, name)`   | è®¿é—®ä»»ä½•å±æ€§æ—¶éƒ½è§¦å‘  | **ç»Ÿä¸€ç›‘æ§ã€æ—¥å¿—ã€æƒé™æ£€æŸ¥ã€ä»£ç†è½¬å‘**   | â€œæ‰€æœ‰è®¿é—®éƒ½è¦è¿‡æˆ‘â€   |
| `__setattr__(self, name, value)` | ç»™å±æ€§èµ‹å€¼æ—¶è§¦å‘    | **é™åˆ¶ä¿®æ”¹ã€ç±»å‹æ ¡éªŒã€è‡ªåŠ¨è½¬æ¢**      | â€œè®¾ç½®å±æ€§æ—¶è‡ªåŠ¨åšç‚¹äº‹â€ |

- è‡ªåŠ¨è¡¥å……æˆ–é»˜è®¤å±æ€§ï¼ˆç”¨ `__getattr__`ï¼‰
      - å½“ç”¨æˆ·è®¿é—®ä¸å­˜åœ¨çš„å±æ€§æ—¶ï¼Œä¸æƒ³ç›´æ¥æŠ¥é”™ï¼Œè€Œæ˜¯â€œåŠ¨æ€è®¡ç®—â€æˆ–â€œæä¾›é»˜è®¤å€¼â€ã€‚

```python
class Config:
    def __init__(self):
        self.db_host = "localhost"

    def __getattr__(self, name):
        # å½“è®¿é—®ä¸å­˜åœ¨çš„å±æ€§æ—¶æ‰ä¼šè¢«è°ƒç”¨
        print(f"å±æ€§ {name} ä¸å­˜åœ¨ï¼Œè¿”å›é»˜è®¤å€¼ None")
        return None

cfg = Config()
print(cfg.db_host)  # æ­£å¸¸å­˜åœ¨ -> localhost
print(cfg.timeout)  # ä¸å­˜åœ¨ -> è‡ªåŠ¨è¿”å› None è€Œä¸æ˜¯æŠ¥é”™
```

- æ‹¦æˆªæ‰€æœ‰å±æ€§è®¿é—®ï¼ˆç”¨ `__getattribute__`ï¼‰
      - æƒ³åœ¨æ¯æ¬¡è®¿é—®å±æ€§æ—¶éƒ½åšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚ï¼š
        - æ‰“å°æ—¥å¿—;
        - æ£€æŸ¥æƒé™;
        - å®ç°â€œä»£ç†å¯¹è±¡â€ï¼ˆæŠŠè®¿é—®è½¬å‘ç»™å¦ä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚

```python
class UserProxy:
    def __init__(self, real_user):
        object.__setattr__(self, "real_user", real_user)

    def __getattribute__(self, name):
        print(f"æ­£åœ¨è®¿é—®å±æ€§ï¼š{name}")
        real_user = object.__getattribute__(self, "real_user")
        return getattr(real_user, name)  # è½¬å‘ç»™çœŸå®å¯¹è±¡

user = {"name": "Tom", "age": 18}
proxy = UserProxy(user)

print(proxy["name"])  # => æ‰“å°â€œæ­£åœ¨è®¿é—®å±æ€§ï¼š__getitem__â€
```

- æ‹¦æˆªèµ‹å€¼æ“ä½œï¼ˆç”¨ `__setattr__`ï¼‰
      - å½“ä½ å¸Œæœ›å¯¹èµ‹å€¼è¿‡ç¨‹â€œæ’æ‰‹â€ï¼Œæ¯”å¦‚ï¼š
          - æ ¡éªŒæ•°æ®æ˜¯å¦åˆæ³•;
          - è‡ªåŠ¨ç±»å‹è½¬æ¢;
          - å®ç°åªè¯»å±æ€§;
          - è®°å½•â€œè°æ”¹äº†è¿™ä¸ªå€¼â€ã€‚

```python
class User:
    def __setattr__(self, name, value):
        if name == "age" and value < 0:
            raise ValueError("å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°")
        print(f"è®¾ç½®å±æ€§ {name} = {value}")
        object.__setattr__(self, name, value)

u = User()
u.name = "Tom"   # è®¾ç½®å±æ€§ name = Tom
u.age = 18       # è®¾ç½®å±æ€§ age = 18
u.age = -3       # æŠ¥é”™ï¼šå¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°
```

---

### 5.4 `__slots__`

**`__slots__`æ˜¯ç±»çº§å˜é‡**ï¼Œç”¨æ¥æ˜¾å¼å£°æ˜å¯¹è±¡å…è®¸æœ‰å“ªäº›å±æ€§ã€‚
è¿™æ · Python å°±ä¸ä¼šä¸ºæ¯ä¸ªå®ä¾‹åˆ›å»ºä¸€ä¸ªå¯æ‰©å±•çš„å­—å…¸ï¼ˆ**`__dict__`**ï¼‰ï¼Œä»è€Œï¼š

- èŠ‚çœå†…å­˜ï¼›
- é™åˆ¶å±æ€§ç§ç±»ï¼ˆé˜²æ­¢éšæ„å¢åŠ å±æ€§ï¼‰ï¼›
- è®¿é—®é€Ÿåº¦ç•¥å¿«ã€‚

```python
class User:
    __slots__ = ('name', 'age')  # ä»…å…è®¸è¿™ä¸¤ä¸ªå±æ€§å­˜åœ¨

    def __init__(self, name, age):
        self.name = name
        self.age = age

u = User("Tom", 18)
print(u.name)     # âœ… æ­£å¸¸è®¿é—®
u.name = "Jack"   # âœ… å¯ä»¥ä¿®æ”¹å·²å®šä¹‰çš„å±æ€§

u.city = "Tokyo"  # âŒ æŠ¥é”™ï¼š'User' object has no attribute 'city'
```

- èƒŒåæœºåˆ¶
å¹³å¸¸æ¯ä¸ªå¯¹è±¡éƒ½å¸¦ä¸€ä¸ª `__dict__`ï¼š

```python
obj.__dict__ = {'name': 'Tom', 'age': 18}
```

ä½†å®šä¹‰äº† `__slots__` åï¼Œå¯¹è±¡ä¸å†æœ‰ `__dict__`ï¼ˆé™¤éä½ æ‰‹åŠ¨åŠ ä¸Šï¼‰ã€‚
è¿™æ ·:

- ä¸èƒ½éšæ„æ–°å¢å±æ€§ï¼›
- å†…å­˜å¸ƒå±€æ›´ç´§å‡‘ï¼›
- é€‚åˆå¤§é‡å°å¯¹è±¡çš„åœºæ™¯ï¼ˆå¦‚ç™¾ä¸‡æ¡æ•°æ®è®°å½•ï¼‰ã€‚

- å¸¸è§ç»†èŠ‚

| æƒ…å†µ                | è¯´æ˜                                                     |
| ----------------- | ------------------------------------------------------ |
| å­ç±»æœªå®šä¹‰ `__slots__` | å­ç±»ä»ç„¶å¯ä»¥åŠ¨æ€æ·»åŠ å±æ€§                                           |
| å­ç±»å®šä¹‰ `__slots__`  | éœ€æ˜¾å¼åŒ…å«çˆ¶ç±»çš„ slotsï¼Œå¦åˆ™çˆ¶ç±»å­—æ®µæ— æ³•ä½¿ç”¨                              |
| æƒ³ä¿ç•™åŠ¨æ€å±æ€§           | å¯ä»¥è¿™æ ·å†™ï¼š`__slots__ = ('name', 'age', '__dict__')`        |

---

## 6 ç»§æ‰¿ï¼ˆInheritanceï¼‰

ä¸€ä¸ªç±»ï¼ˆå­ç±»ï¼‰ä»å¦ä¸€ä¸ªç±»ï¼ˆçˆ¶ç±»ï¼‰ç»§æ‰¿å±æ€§å’Œæ–¹æ³•ï¼Œä»¥ä¾¿ä»£ç å¤ç”¨ã€æ‰©å±•åŠŸèƒ½æˆ–ä¿æŒå±‚æ¬¡ç»“æ„ã€‚
å­ç±»ä¼šè‡ªåŠ¨è·å¾—çˆ¶ç±»çš„å±æ€§ä¸æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥ç”¨ï¼Œä¹Ÿå¯ä»¥é‡å†™ï¼ˆoverrideï¼‰ã€‚

### åŸºæœ¬è¯­æ³•

```python
class Animal:                  # çˆ¶ç±»ï¼ˆåŸºç±»ï¼‰
    def eat(self):
        print("åŠ¨ç‰©åœ¨åƒ")

class Dog(Animal):             # å­ç±»ï¼ˆæ´¾ç”Ÿç±»ï¼‰
    def bark(self):
        print("ç‹—åœ¨å«")

d = Dog()
d.eat()    # âœ… ç»§æ‰¿è‡ª Animal  è¾“å‡ºï¼šåŠ¨ç‰©åœ¨åƒ
d.bark()   # âœ… è‡ªå·±çš„æ–¹æ³•   è¾“å‡ºï¼šç‹—åœ¨å«
```

å­ç±» Dog ç»§æ‰¿äº†çˆ¶ç±» Animal çš„ eat() æ–¹æ³•ã€‚
è¿™å°±æ˜¯ç»§æ‰¿çš„æ ¸å¿ƒï¼š**ä»£ç å¤ç”¨ + æ‰©å±•æ–°åŠŸèƒ½**ã€‚

### æ„é€ æ–¹æ³•çš„ç»§æ‰¿ä¸æ‰©å±•

å¦‚æœå­ç±»æ²¡æœ‰å†™ `__init__()`ï¼Œå°±ä¼šè‡ªåŠ¨ç»§æ‰¿çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚
å¦‚æœä½ å†™äº†ï¼Œå°±ä¼šè¦†ç›–çˆ¶ç±»çš„ï¼Œéœ€è¦è‡ªå·±æ‰‹åŠ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ é€»è¾‘ã€‚

```python
#ç»§æ‰¿çˆ¶ç±»æ„é€ æ–¹æ³•
class Animal:
    def __init__(self, name):
        self.name = name

class Dog(Animal):
    pass

dog = Dog("å°ç™½")
print(dog.name)  # å°ç™½
```

```python
#å­ç±»é‡å†™å¹¶æ‰©å±•æ„é€ æ–¹æ³•ï¼ˆç”¨ super()ï¼‰
class Animal:
    def __init__(self, name):
        self.name = name

class Dog(Animal):
    def __init__(self, name, breed):
        super().__init__(name)   # è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•
        self.breed = breed

dog = Dog("å°ç™½", "æŸ´çŠ¬")
print(dog.name, dog.breed)  # å°ç™½ æŸ´çŠ¬
```

- super() æ˜¯çˆ¶ç±»çš„ä¸€ä¸ªâ€œä»£ç†å¯¹è±¡â€ï¼Œç”¨æ¥è°ƒç”¨çˆ¶ç±»æ–¹æ³•ã€‚
- å®ƒéµå¾ª MROï¼ˆæ–¹æ³•è§£æé¡ºåºï¼‰ï¼Œåœ¨å¤šç»§æ‰¿ä¸­éå¸¸é‡è¦ã€‚

### æ–¹æ³•é‡å†™ï¼ˆOverrideï¼‰

å­ç±»ä¸­å¯ä»¥å®šä¹‰ä¸çˆ¶ç±»åŒåçš„æ–¹æ³•ï¼Œä»¥å®ç°â€œæ›¿æ¢çˆ¶ç±»é€»è¾‘â€çš„æ•ˆæœã€‚

```python
class Animal:
    def speak(self):
        print("åŠ¨ç‰©åœ¨å«")

class Dog(Animal):
    def speak(self):     # é‡å†™çˆ¶ç±»æ–¹æ³•
        print("ç‹—åœ¨æ±ªæ±ªå«")

Dog().speak()  # ç‹—åœ¨æ±ªæ±ªå«
```

å¦‚æœä»æƒ³åœ¨å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»çš„é€»è¾‘ï¼Œå¯ä»¥ä½¿ç”¨ï¼š

```python
class Dog(Animal):
    def speak(self):
        super().speak()   # è°ƒç”¨çˆ¶ç±»æ–¹æ³•
        print("ç‹—åœ¨æ±ªæ±ªå«")
```

### å±æ€§ç»§æ‰¿è§„åˆ™

1. å­ç±»å¯ä»¥è®¿é—®çˆ¶ç±»çš„å±æ€§ï¼›
2. å­ç±»å¯å®šä¹‰ä¸çˆ¶ç±»åŒåå±æ€§ â†’ ä¼šè¦†ç›–ï¼›
3. `super()` å¯ä»¥è®¿é—®çˆ¶ç±»ç‰ˆæœ¬çš„å±æ€§ã€‚

```python
class A:
    x = 10

class B(A):
    x = 20

print(A.x)   # 10
print(B.x)   # 20
```

### å¤šé‡ç»§æ‰¿

Python å…è®¸ä¸€ä¸ªç±»ç»§æ‰¿å¤šä¸ªçˆ¶ç±»ï¼š

```python
class A:
    def greet(self):
        print("A say hi")

class B:
    def greet(self):
        print("B say hello")

class C(A, B):   # åŒæ—¶ç»§æ‰¿ A å’Œ B
    pass

C().greet()  # A say hi
```

ğŸ‘‰ è¯´æ˜ï¼šPython éµå¾ª MROï¼ˆMethod Resolution Orderï¼‰æ–¹æ³•è§£æé¡ºåºã€‚
ä¼˜å…ˆæŸ¥æ‰¾ä»å·¦åˆ°å³çš„ç»§æ‰¿é¡ºåºã€‚

å¯ä»¥æŸ¥çœ‹è§£æé¡ºåºï¼š

```python
print(C.__mro__) #(<class '__main__.C'>, <class '__main__.A'>, <class '__main__.B'>, <class 'object'>)
```

### object ç±»

åœ¨ Python 3 ä¸­ï¼Œæ‰€æœ‰ç±»éƒ½é»˜è®¤ç»§æ‰¿è‡ª objectï¼š

```python
class A:
    pass

print(A.__mro__)
# (<class '__main__.A'>, <class 'object'>)
```

å› æ­¤å³ä½¿ä½ ä¸å†™ (object)ï¼Œä¹Ÿè‡ªåŠ¨ç»§æ‰¿ã€‚

### ç»§æ‰¿çš„ç±»å‹æ€»ç»“

| ç±»å‹   | è¯´æ˜            | è¯­æ³•                            |
| ---- | ------------- | ----------------------------- |
| å•ç»§æ‰¿  | ä¸€ä¸ªå­ç±»ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»    | `class Dog(Animal):`          |
| å¤šé‡ç»§æ‰¿ | ä¸€ä¸ªå­ç±»ç»§æ‰¿å¤šä¸ªçˆ¶ç±»    | `class C(A, B):`              |
| å¤šå±‚ç»§æ‰¿ | ä¸€å±‚ç»§æ‰¿å¦ä¸€å±‚       | `class C(B):` ä¸” `class B(A):` |
| ç»„åˆç»§æ‰¿ | ç±»ä¸­æ—¢ç»§æ‰¿åˆç»„åˆä½¿ç”¨å…¶ä»–ç±» | åœ¨ç±»ä¸­ä»¥å±æ€§å½¢å¼åŒ…å«å¦ä¸€ä¸ªç±»å®ä¾‹              |

### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç»§æ‰¿ï¼Ÿ

- å¤šä¸ªç±»æœ‰ç›¸ä¼¼å±æ€§æˆ–æ–¹æ³• â†’ æå–åˆ°çˆ¶ç±»ä¸­ï¼›
- æƒ³åœ¨å­ç±»ä¸­å¤ç”¨çˆ¶ç±»é€»è¾‘ï¼›
- æƒ³é€šè¿‡â€œå¤šæ€â€ç»Ÿä¸€æ¥å£è¡Œä¸ºï¼›
- æƒ³ç”¨ super() é“¾å¼è°ƒç”¨å¤šä¸ªç±»çš„åˆå§‹åŒ–ã€‚

### ç»§æ‰¿ vs ç»„åˆ

| å¯¹æ¯”é¡¹ | ç»§æ‰¿ï¼ˆis-aï¼‰     | ç»„åˆï¼ˆhas-aï¼‰     |
| :-- | :----------- | :------------ |
| å«ä¹‰  | å­ç±»æ˜¯çˆ¶ç±»çš„ä¸€ç§     | ç±»ä¸­â€œåŒ…å«â€å¦ä¸€ä¸ªç±»    |
| å…³ç³»  | Dog æ˜¯ Animal | Dog æ‹¥æœ‰ä¸€ä¸ª Tail |
| ä¼˜ç‚¹  | ä»£ç å¤ç”¨ï¼Œå±‚çº§æ¸…æ™°    | çµæ´»ï¼Œä¸å—çˆ¶ç±»ç»“æ„é™åˆ¶   |
| ç¼ºç‚¹  | è€¦åˆåº¦é«˜ï¼Œç»“æ„åƒµåŒ–    | ä»£ç ç•¥ç¹çä½†è§£è€¦      |

```python
# ç»§æ‰¿å…³ç³»
class Animal: pass
class Dog(Animal): pass  # Dog æ˜¯ Animal

# ç»„åˆå…³ç³»
class Tail: pass
class Dog:
    def __init__(self):
        self.tail = Tail()  # Dog æ‹¥æœ‰ Tail
```

### æ€»ç»“

class SubClass(BaseClass): è¡¨ç¤ºç»§æ‰¿ã€‚
å­ç±»è‡ªåŠ¨æ‹¥æœ‰çˆ¶ç±»çš„å±æ€§ä¸æ–¹æ³•ã€‚
å¯é€šè¿‡ super() è°ƒç”¨çˆ¶ç±»é€»è¾‘ã€‚
Python æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œéµå¾ª MRO é¡ºåºã€‚
åˆç†ä½¿ç”¨ç»§æ‰¿èƒ½å¤§å¹…æé«˜ä»£ç å¤ç”¨æ€§ä¸ç»“æ„æ¸…æ™°åº¦ã€‚

---

## 7 å¤šæ€

å¤šæ€ï¼ˆPolymorphismï¼‰ æ„æ€æ˜¯ï¼šâ€œåŒä¸€ä¸ªæ¥å£ï¼Œä¸åŒå¯¹è±¡è¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºâ€ã€‚

ç®€å•æ¥è¯´ï¼š

- åŒæ ·çš„æ–¹æ³•åï¼›
- è°ƒç”¨æ—¶æ ¹æ®å¯¹è±¡çš„çœŸå®ç±»å‹æ‰§è¡Œä¸åŒé€»è¾‘ã€‚

```python
class Animal:
    def speak(self):
        print("åŠ¨ç‰©åœ¨å«")

class Dog(Animal):
    def speak(self):
        print("ç‹—åœ¨æ±ªæ±ªå«")

class Cat(Animal):
    def speak(self):
        print("çŒ«åœ¨å–µå–µå«")

def make_sound(animal):
    animal.speak()

# ä¼ å…¥ä¸åŒå¯¹è±¡
make_sound(Dog())   # ç‹—åœ¨æ±ªæ±ªå«
make_sound(Cat())   # çŒ«åœ¨å–µå–µå«
```

`make_sound()` å‡½æ•°ä¸éœ€è¦çŸ¥é“å‚æ•°æ˜¯ Dog è¿˜æ˜¯ Catï¼Œ
å®ƒåªå…³å¿ƒ â€œè¿™ä¸ªå¯¹è±¡æœ‰æ²¡æœ‰ speak() æ–¹æ³•â€ã€‚
è¿™å°±æ˜¯ å¤šæ€çš„ç²¾é«“ï¼šæ¥å£ç»Ÿä¸€ï¼Œè¡Œä¸ºå¤šæ ·ã€‚

### Python çš„å¤šæ€æ˜¯â€œåŠ¨æ€å¤šæ€â€

åœ¨åƒ Javaã€C++ è¿™æ ·çš„é™æ€è¯­è¨€ä¸­ï¼Œå¤šæ€ä¾èµ–ç±»å‹å£°æ˜ï¼Œ
ä½† Python æ˜¯åŠ¨æ€è¯­è¨€ï¼Œå¤©ç”Ÿå°±æ”¯æŒå¤šæ€ï¼ˆé¸­å­ç±»å‹ Duck Typingï¼‰ã€‚

```mkdocs
ğŸ¦† â€œå¦‚æœå®ƒèµ°èµ·æ¥åƒé¸­å­ï¼Œå«èµ·æ¥ä¹Ÿåƒé¸­å­ï¼Œé‚£å®ƒå°±æ˜¯é¸­å­ã€‚â€
```

å³ï¼š
åªè¦ä¸€ä¸ªå¯¹è±¡**å®ç°äº†ç›¸åº”çš„æ–¹æ³•**ï¼Œæ— è®ºå®ƒæ˜¯ä»€ä¹ˆç±»ï¼Œéƒ½å¯ä»¥è¢«å½“ä½œæŸç§ç±»å‹ä½¿ç”¨ã€‚

```python
class Duck:
    def quack(self):
        print("å˜å˜")

class Person:
    def quack(self):
        print("æˆ‘å­¦é¸­å­å«ï¼šå˜å˜")

def make_it_quack(obj):
    obj.quack()  # ä¸å…³å¿ƒç±»å‹ï¼Œåªè¦æ±‚æœ‰ quack() æ–¹æ³•

make_it_quack(Duck())        #å˜å˜
make_it_quack(Person())      #æˆ‘å­¦é¸­å­å«ï¼šå˜å˜
```

Python çš„å¤šæ€æ˜¯åŸºäºè¡Œä¸ºè€Œéç±»å‹ï¼Œ
è¿™ä¹Ÿç§°ä¸º **è¡Œä¸ºå¤šæ€ï¼ˆbehavioral polymorphismï¼‰**ã€‚

### ç»§æ‰¿ + é‡å†™ = å®ç°å¤šæ€çš„åŸºç¡€

å¤šæ•°æƒ…å†µä¸‹ï¼Œå¤šæ€é€šè¿‡ç»§æ‰¿æ¥å®ç°ã€‚
çˆ¶ç±»å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œå­ç±»é‡å†™å®ƒã€‚
è¿™æ ·å°±èƒ½åœ¨ç»Ÿä¸€çš„ç»“æ„ä¸‹å®ç°ä¸åŒè¡¨ç°ã€‚

```python
class Shape:
    def area(self):
        raise NotImplementedError("å­ç±»å¿…é¡»å®ç° area()")

class Circle(Shape):
    def __init__(self, r):
        self.r = r
    def area(self):
        return 3.14 * self.r ** 2

class Rectangle(Shape):
    def __init__(self, w, h):
        self.w = w
        self.h = h
    def area(self):
        return self.w * self.h

shapes = [Circle(3), Rectangle(4, 5)] 
for s in shapes:
    print(s.area())  #28.26  20
```

> å¤šæ€çš„å…³é”®ï¼š
> åŒæ ·è°ƒç”¨ s.area()ï¼Œä½†ä¸åŒç±»ç»™å‡ºä¸åŒå®ç°ã€‚
> è¿™è®©ä»£ç æ›´é€šç”¨ã€å¯æ‰©å±•ã€æ˜“ç»´æŠ¤ã€‚

### Python å¤šæ€çš„åˆ†ç±»

| ç±»å‹         | å«ä¹‰               | ç¤ºä¾‹                           |
| :--------- | :--------------- | :--------------------------- |
| **ç»§æ‰¿å¤šæ€**   | çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡       | `animal.speak()`             |
| **è¿ç®—ç¬¦å¤šæ€**  | åŒä¸€è¿ç®—ç¬¦å¯¹ä¸åŒç±»å‹è¡Œä¸ºä¸åŒ   | `"a"+"b"`, `1+2`, `[1]+[2]`  |
| **å‡½æ•°å¤šæ€**   | åŒä¸€å‡½æ•°å¤„ç†ä¸åŒç±»å‹å¯¹è±¡     | `len("abc")`, `len([1,2,3])` |
| **é¸­å­ç±»å‹å¤šæ€** | ä¸ä¾èµ–ç»§æ‰¿ï¼Œåªè¦å®ç°åŒåæ–¹æ³•å³å¯ | `obj.quack()`                |

### è¿ç®—ç¬¦çš„å¤šæ€ï¼ˆè¿ç®—ç¬¦é‡è½½ï¼‰

Python ä¸­çš„è¿ç®—ç¬¦æœ¬èº«å°±æ˜¯å¤šæ€çš„ä¾‹å­ï¼š

```python
print(1 + 2)          # æ•°å­—ç›¸åŠ 
print("a" + "b")      # å­—ç¬¦ä¸²æ‹¼æ¥
print([1] + [2, 3])   # åˆ—è¡¨åˆå¹¶

#åº•å±‚å®é™…ä¸Šåˆ†åˆ«è°ƒç”¨äº†ï¼š
int.__add__
str.__add__
list.__add__
```

ğŸ‘‰ è¿™å«åš**è¿ç®—ç¬¦é‡è½½ï¼ˆOperator Overloadingï¼‰**ï¼Œ
å®ƒè®© + åœ¨ä¸åŒç±»å‹ä¸Šå…·æœ‰ä¸åŒå«ä¹‰ï¼Œä¹Ÿæ˜¯å¤šæ€çš„ä¸€ç§ä½“ç°ã€‚

### æ¥å£å¤šæ€ï¼ˆé¢å‘æŠ½è±¡ç¼–ç¨‹ï¼‰

å¤šæ€çš„æœ€å¤§æ„ä¹‰åœ¨äºâ€œé¢å‘æŠ½è±¡ç¼–ç¨‹â€ï¼š
ä½ å¯ä»¥é’ˆå¯¹â€œè¡Œä¸ºæ¥å£â€ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯å…·ä½“ç±»å‹ã€‚

```python
class File:
    def read(self): pass

class TextFile(File):
    def read(self): return "è¯»å–æ–‡æœ¬æ–‡ä»¶"

class JsonFile(File):
    def read(self): return "è¯»å– JSON æ–‡ä»¶"

def load_file(file: File):
    print(file.read())

load_file(TextFile())
load_file(JsonFile())
```

âœ… æ–°å¢ä¸€ä¸ª CsvFile(File) ç±»ï¼Œä¹Ÿèƒ½ç›´æ¥è¢« load_file() è°ƒç”¨ï¼Œ
è€Œä¸ç”¨æ”¹åŸå‡½æ•°é€»è¾‘ â€”â€” è¿™å°±æ˜¯â€œå¯æ‰©å±•æ€§â€çš„ä½“ç°ã€‚

### å’Œâ€œæ–¹æ³•é‡è½½â€åŒºåˆ«

| å¯¹æ¯”é¡¹         | æ–¹æ³•é‡è½½ï¼ˆOverloadingï¼‰ | å¤šæ€ï¼ˆPolymorphismï¼‰ |
| :---------- | :---------------- | :--------------- |
| å‘ç”Ÿä½ç½®        | åŒä¸€ä¸ªç±»ä¸­             | çˆ¶ç±»ä¸å­ç±»ä¹‹é—´          |
| å‚æ•°å·®å¼‚        | å‚æ•°æ•°é‡æˆ–ç±»å‹ä¸åŒ         | ç›¸åŒæ¥å£ï¼Œä¸åŒå®ç°        |
| Python æ˜¯å¦æ”¯æŒ | ä»…ä¼ªé‡è½½ï¼ˆåŠ¨æ€å‚æ•°ï¼‰        | âœ… å¤©ç”Ÿæ”¯æŒ           |
| æ ¸å¿ƒæ€æƒ³        | åŒåå¤šå®ç°ï¼ˆæŒ‰å‚æ•°é€‰ï¼‰       | åŒæ¥å£å¤šè¡¨ç°ï¼ˆæŒ‰å¯¹è±¡é€‰ï¼‰     |

### å®é™…é¡¹ç›®ä¸­å¤šæ€çš„å¥½å¤„

1. å¯æ‰©å±•æ€§å¼º

```python
def draw(shape):
    shape.area()  # ä¸ç”¨æ”¹è¿™è¡Œ
```

ä½ å¯ä»¥éšæ—¶æ–°å¢ Triangle, Ellipse ç±»ï¼Œè€Œæ— éœ€æ”¹ draw()ã€‚
2. æ¥å£ç»Ÿä¸€
è®©ä¸Šå±‚ä»£ç åªå…³å¿ƒâ€œèƒ½å¹²ä»€ä¹ˆâ€ï¼Œè€Œä¸å…³å¿ƒâ€œæ˜¯è°å¹²çš„â€ã€‚
3. ä½è€¦åˆ
ä¸åŒæ¨¡å—å¯ç‹¬ç«‹å®ç°è‡ªå·±çš„è¡Œä¸ºï¼Œåªéœ€éµå®ˆåŒä¸€ä¸ªæ¥å£ã€‚
4. æµ‹è¯•æ›´æ–¹ä¾¿
å¤šæ€è®©ä½ å¯ä»¥åœ¨æµ‹è¯•ä¸­ç”¨â€œå‡å¯¹è±¡ï¼ˆmockï¼‰â€æ›¿æ¢çœŸå¯¹è±¡ã€‚

### å…³é”®ç‚¹æ€»ç»“

| æ¦‚å¿µ               | å«ä¹‰                    |
| ---------------- | --------------------- |
| å¤šæ€ï¼ˆPolymorphismï¼‰ | åŒä¸€æ–¹æ³•åï¼Œä½œç”¨äºä¸åŒå¯¹è±¡ï¼Œè¡¨ç°å‡ºä¸åŒè¡Œä¸º |
| å®ç°åŸºç¡€             | ç»§æ‰¿ + æ–¹æ³•é‡å†™             |
| Python ç‰¹ç‚¹        | åŠ¨æ€å¤šæ€ï¼ŒåŸºäºè¡Œä¸ºï¼ˆé¸­å­ç±»å‹ï¼‰       |
| ä¼˜ç‚¹               | ä»£ç å¤ç”¨ã€æ‰©å±•æ€§å¼ºã€æ˜“ç»´æŠ¤         |
| å¸¸è§ä½“ç°             | å‡½æ•°å¤šæ€ã€è¿ç®—ç¬¦å¤šæ€ã€æ¥å£å¤šæ€       |

### å¤šæ€æ€»ç»“

å¤šæ€è®©ä»£ç â€œé¢å‘æ¥å£â€è€Œä¸æ˜¯â€œé¢å‘å®ç°â€ã€‚
å®ƒæ˜¯è®©ä½ çš„ Python ç¨‹åºä»â€œèƒ½è·‘â€å˜æˆâ€œä¼˜é›…ä¸”å¯æ‰©å±•â€çš„å…³é”®

---

## 8 ç»„åˆä¸å§”æ‰˜

### å‰ç½®ç†è§£ï¼šç»§æ‰¿çš„å±€é™

æˆ‘ä»¬å…ˆå›é¡¾ç»§æ‰¿çš„ç‰¹ç‚¹ğŸ‘‡

```python
class Animal:
    def speak(self):
        print("åŠ¨ç‰©åœ¨å«")

class Dog(Animal):
    def speak(self):
        print("ç‹—åœ¨æ±ªæ±ªå«")
```

ç»§æ‰¿ç¡®å®æ–¹ä¾¿ï¼Œä½†æœ‰è¿™äº›é—®é¢˜ï¼š

- âŒ å­ç±»å¼ºä¾èµ–çˆ¶ç±»ç»“æ„ï¼ˆè€¦åˆåº¦é«˜ï¼‰ï¼›
- âŒ ä¿®æ”¹çˆ¶ç±»ä¼šå½±å“æ‰€æœ‰å­ç±»ï¼›
- âŒ ç»§æ‰¿åªèƒ½è¡¨è¾¾â€œis-aâ€å…³ç³»ï¼Œè€Œä¸æ˜¯â€œhas-aâ€ï¼›
- âŒ å¤šé‡ç»§æ‰¿ç»“æ„å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™ã€‚
äºæ˜¯ï¼Œå°±æœ‰äº†æ›´çµæ´»çš„ä¸¤ç§æ›¿ä»£æ–¹æ¡ˆï¼š
ğŸ‘‰ **ç»„åˆï¼ˆCompositionï¼‰** ä¸ **å§”æ‰˜ï¼ˆDelegationï¼‰**

### ç»„åˆï¼ˆCompositionï¼‰è¯¦è§£

>ç»„åˆæ˜¯ä¸€ç§â€œhas-aï¼ˆæ‹¥æœ‰ï¼‰â€å…³ç³»ã€‚
>æŒ‡ä¸€ä¸ªç±»æŠŠå¦ä¸€ä¸ªç±»çš„å¯¹è±¡ä½œä¸ºè‡ªå·±çš„å±æ€§ï¼Œä»¥æ­¤å®ç°åŠŸèƒ½å¤ç”¨ã€‚
æ¢å¥è¯è¯´ï¼š
>â€œä¸æ˜¯å»ç»§æ‰¿å®ƒï¼Œè€Œæ˜¯å»åŒ…å«å®ƒã€‚â€

```python
#ç»„åˆå…³ç³»

class Engine:
    def start(self):
        print("å¼•æ“å¯åŠ¨")

class Car:
    def __init__(self):
        self.engine = Engine()   # Car æ‹¥æœ‰ä¸€ä¸ª Engine

    def drive(self):
        print("æ±½è½¦å¼€å§‹è¡Œé©¶")
        self.engine.start()      # è°ƒç”¨å¼•æ“çš„åŠŸèƒ½

car = Car()     #æ±½è½¦å¼€å§‹è¡Œé©¶
car.drive()     #å¼•æ“å¯åŠ¨
```

ğŸ‘‰ Car é€šè¿‡â€œæ‹¥æœ‰â€ Engine çš„å®ä¾‹æ¥ä½¿ç”¨å®ƒçš„åŠŸèƒ½ã€‚
è¿™ç§â€œCar has a Engineâ€çš„å…³ç³»å°±æ˜¯ ç»„åˆã€‚

| ä¼˜ç‚¹        | è¯´æ˜                       |
| --------- | ------------------------ |
| âœ… ä½è€¦åˆ     | ä¿®æ”¹ Engine ä¸ä¼šå½±å“ Car çš„ç»§æ‰¿ç»“æ„ |
| âœ… çµæ´»      | å¯ä»¥è‡ªç”±ç»„åˆä¸åŒç»„ä»¶ï¼ˆå¦‚æ¢ä¸åŒ Engineï¼‰  |
| âœ… æ›´è´´è¿‘ç°å®å»ºæ¨¡ | â€œæ±½è½¦æœ‰å¼•æ“â€æ¯”â€œæ±½è½¦æ˜¯å¼•æ“â€æ›´åˆç†       |
| âœ… å¯æ›¿æ¢æ€§å¼º   | ä¸åŒå®ç°ç±»å¯éšæ—¶æ›¿æ¢               |

```python
#å¯æ›¿æ¢çš„ç»„ä»¶ç»„åˆ
class ElectricEngine:
    def start(self):
        print("ç”µåŠ¨å¼•æ“å¯åŠ¨")

class GasEngine:
    def start(self):
        print("æ±½æ²¹å¼•æ“å¯åŠ¨")

class Car:
    def __init__(self, engine):
        self.engine = engine    # é€šè¿‡ç»„åˆæ³¨å…¥ä¸åŒå¼•æ“

    def drive(self):
        self.engine.start()

Car(ElectricEngine()).drive()   #ç”µåŠ¨å¼•æ“å¯åŠ¨
Car(GasEngine()).drive()        #æ±½æ²¹å¼•æ“å¯åŠ¨
```

>âœ… è¿™å°±æ˜¯â€œç»„åˆ + å¤šæ€â€çš„å…¸å‹åº”ç”¨ã€‚
>Car å¹¶ä¸å…³å¿ƒ engine æ˜¯å“ªç§ç±»å‹ï¼Œåªè¦æœ‰ .start() æ–¹æ³•å³å¯ã€‚

### å§”æ‰˜ï¼ˆDelegationï¼‰è¯¦è§£

>å§”æ‰˜ï¼ˆDelegationï¼‰ æ˜¯ä¸€ç§è¡Œä¸ºè½¬å‘ï¼š
>å½“å‰ç±»ä¸è‡ªå·±å®ç°æŸä¸ªåŠŸèƒ½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚äº¤ç»™å¦ä¸€ä¸ªå¯¹è±¡å»åšã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼š
>â€œæˆ‘ä¸å¹²è¿™æ´»ï¼Œæˆ‘è®©åˆ«äººï¼ˆè¢«å§”æ‰˜å¯¹è±¡ï¼‰å¹²ã€‚â€

```python
#ç®€å•çš„å§”æ‰˜
class Printer:
    def print_doc(self):
        print("æ‰“å°æ–‡æ¡£...")

class Computer:
    def __init__(self):
        self.printer = Printer()

    def print(self):
        # å°†è¯·æ±‚â€œå§”æ‰˜â€ç»™ Printer å¯¹è±¡
        self.printer.print_doc()

pc = Computer()
pc.print()      #æ‰“å°æ–‡æ¡£...
```

å§”æ‰˜æ˜¯â€œè¡Œä¸ºè½¬å‘â€ï¼Œè€Œç»„åˆæ˜¯â€œç»“æ„åŒ…å«â€ã€‚
ä¸¤è€…ç»å¸¸ä¸€èµ·å‡ºç°ï¼Œä½†ä¸æ˜¯ä¸€å›äº‹ã€‚

- ç»„åˆ vs å§”æ‰˜ çš„åŒºåˆ«

| å¯¹æ¯”é¡¹      | ç»„åˆï¼ˆCompositionï¼‰ | å§”æ‰˜ï¼ˆDelegationï¼‰      |
| :------- | :-------------- | :------------------ |
| å«ä¹‰       | ä¸€ä¸ªå¯¹è±¡â€œæ‹¥æœ‰â€å¦ä¸€ä¸ªå¯¹è±¡   | ä¸€ä¸ªå¯¹è±¡â€œæŠŠè¯·æ±‚äº¤ç»™â€å¦ä¸€ä¸ªå¯¹è±¡    |
| å…³ç³»       | **has-a**       | **uses-a**          |
| ç›®çš„       | ç»“æ„å¤ç”¨            | è¡Œä¸ºè½¬å‘                |
| å®ç°æ–¹å¼     | å±æ€§å¼•ç”¨å¦ä¸€ä¸ªå¯¹è±¡       | æ–¹æ³•å†…éƒ¨è°ƒç”¨å¦ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•      |
| ç¤ºä¾‹       | Car åŒ…å« Engine   | Computer è°ƒç”¨ Printer |
| æ˜¯å¦ä¸€å®šè½¬å‘è°ƒç”¨ | âŒ ä¸ä¸€å®šï¼ˆå¯ç‹¬ç«‹ä½¿ç”¨ï¼‰    | âœ… å¿…å®šæ˜¯è°ƒç”¨è½¬å‘           |

- å§”æ‰˜çš„é«˜çº§å†™æ³•ï¼šåŠ¨æ€è½¬å‘

æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›â€œè‡ªåŠ¨â€æŠŠæœªçŸ¥å±æ€§çš„è®¿é—®éƒ½å§”æ‰˜ç»™æŸä¸ªå¯¹è±¡ã€‚
å¯ä»¥ç”¨ `__getattr__` æˆ– `__getattribute__` å®ç°ã€‚

```python
#åŠ¨æ€å§”æ‰˜
class Proxy:
    def __init__(self, target):
        self._target = target

    def __getattr__(self, name):
        # å½“ Proxy è‡ªå·±æ²¡æœ‰è¿™ä¸ªå±æ€§æ—¶ï¼Œè‡ªåŠ¨è½¬å‘åˆ° target
        return getattr(self._target, name)

class RealObject:
    def action(self):
        print("æ‰§è¡ŒçœŸå®å¯¹è±¡çš„æ“ä½œ")

proxy = Proxy(RealObject())
proxy.action()  # å®é™…è°ƒç”¨çš„æ˜¯ RealObject.action()  æ‰§è¡ŒçœŸå®å¯¹è±¡çš„æ“ä½œ
```

>è¿™å°±æ˜¯ Python ç‰ˆçš„â€œä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰â€ã€‚
>Proxy é€šè¿‡å§”æ‰˜è½¬å‘ï¼Œå®ç°äº†â€œæ§åˆ¶è®¿é—®â€çš„ä¸­é—´å±‚ã€‚

- ç»„åˆ + å§”æ‰˜ åœ¨è®¾è®¡æ¨¡å¼ä¸­çš„å…¸å‹åº”ç”¨

| æ¨¡å¼åç§°                  | ä½¿ç”¨æ–¹å¼           | ç¤ºä¾‹        |
| --------------------- | -------------- | --------- |
| **ä»£ç†æ¨¡å¼ (Proxy)**      | ç”¨å§”æ‰˜è½¬å‘è®¿é—®ç›®æ ‡å¯¹è±¡    | ç½‘ç»œä»£ç†ã€æƒé™æ§åˆ¶ |
| **è£…é¥°å™¨æ¨¡å¼ (Decorator)** | ç»„åˆ + å§”æ‰˜åŒ…è£…åŠŸèƒ½    | æ—¥å¿—åŒ…è£…ã€ç¼“å­˜åŠŸèƒ½ |
| **é€‚é…å™¨æ¨¡å¼ (Adapter)**   | ç»„åˆæ—§å¯¹è±¡ + å§”æ‰˜æ¥å£è°ƒç”¨ | å…¼å®¹ä¸åŒæ¥å£    |
| **ç»„åˆæ¨¡å¼ (Composite)**  | å±‚å±‚ç»„åˆå­å¯¹è±¡        | æ ‘å½¢ç»“æ„ï¼ˆå¦‚ç›®å½•ï¼‰ |
| **ç­–ç•¥æ¨¡å¼ (Strategy)**   | ç»„åˆä¸åŒç®—æ³•å¯¹è±¡       | åŠ¨æ€åˆ‡æ¢ç®—æ³•é€»è¾‘  |

- ç»§æ‰¿ vs ç»„åˆ vs å§”æ‰˜

| ç‰¹æ€§   | ç»§æ‰¿ (is-a)     | ç»„åˆ (has-a)    | å§”æ‰˜ (uses-a)         |
| ---- | ------------- | ------------- | ------------------- |
| å…³ç³»ç±»å‹ | çˆ¶å­å…³ç³»          | æ‹¥æœ‰å…³ç³»          | ä½¿ç”¨å…³ç³»                |
| è€¦åˆæ€§  | é«˜             | ä½             | ä½                   |
| ä»£ç å¤ç”¨ | é€šè¿‡ç»§æ‰¿è·å¾—        | é€šè¿‡ç»„åˆå¤ç”¨        | é€šè¿‡è°ƒç”¨å¤ç”¨              |
| æ‰©å±•æ–¹å¼ | é‡å†™çˆ¶ç±»          | æ›´æ¢ç»„ä»¶          | æ›´æ¢ä»£ç†å¯¹è±¡              |
| ç¤ºä¾‹   | `Dog(Animal)` | `Car(Engine)` | `Proxy(RealObject)` |

- å®æˆ˜å¯¹æ¯”ç¤ºä¾‹ï¼šç»§æ‰¿ vs ç»„åˆ+å§”æ‰˜

```python
#ä½¿ç”¨ç»§æ‰¿ï¼ˆè€¦åˆå¤ªå¼ºï¼‰
class FileLogger:
    def log(self, msg):
        print("[File] " + msg)

class App(FileLogger):
    def run(self):
        self.log("App start")
```

é—®é¢˜ï¼š
å¦‚æœè¦æ”¹æˆæ•°æ®åº“æ—¥å¿—ï¼Œè¿˜å¾—æ”¹ç»§æ‰¿å…³ç³»ã€‚

```python
âœ… ä½¿ç”¨ç»„åˆ+å§”æ‰˜ï¼ˆæ›´çµæ´»ï¼‰
class FileLogger:
    def log(self, msg):
        print("[File] " + msg)

class DBLogger:
    def log(self, msg):
        print("[DB] " + msg)

class App:
    def __init__(self, logger):
        self.logger = logger    # ç»„åˆ
    def run(self):
        self.logger.log("App start")  # å§”æ‰˜

App(FileLogger()).run()     #[File] App start
App(DBLogger()).run()       #[DB] App start
```

> ä¸ç”¨æ”¹ App ç±»ï¼Œåªéœ€ä¼ å…¥ä¸åŒçš„ logger å¯¹è±¡ã€‚
> è¿™æ­£æ˜¯â€œç»„åˆä¼˜äºç»§æ‰¿â€çš„ä½“ç°ã€‚

### æ€æƒ³æ€»ç»“

| æ€æƒ³     | ä¸€å¥è¯è§£é‡Š             |
| ------ | ----------------- |
| **ç»§æ‰¿** | â€œæˆ‘å°±æ˜¯å®ƒâ€ â†’ å¤ç”¨ç»“æ„ä½†è€¦åˆé«˜ |
| **ç»„åˆ** | â€œæˆ‘æœ‰å®ƒâ€ â†’ å¤ç”¨åŠŸèƒ½ä¸”çµæ´»   |
| **å§”æ‰˜** | â€œæˆ‘è®©å®ƒå¹²â€ â†’ å¤ç”¨è¡Œä¸ºä¸”å¯æ§åˆ¶ |

>é¢å‘å¯¹è±¡ç¼–ç¨‹çš„é»„é‡‘æ³•åˆ™ï¼š
>ä¼˜å…ˆä½¿ç”¨ç»„åˆä¸å§”æ‰˜ï¼Œè€Œéç»§æ‰¿ã€‚
---

# 用户与权限管理

> 本章目标：  
>
> - 理解 Linux 多用户设计思想  
> - 掌握用户、组、权限的基本概念  
> - 能读懂 rwx 权限并正确设置  
> - 理解 sudo 的真实作用与生产环境规范

---

## 1. 为什么 Linux 要有用户和权限？

Linux 从设计之初就是 **多用户操作系统**。

核心目的：

- 防止误操作
- 提高系统安全性
- 区分职责（开发 / 运维 / 应用）

一句话理解：
> **不是所有人都应该“能做所有事”**

---

## 2. Linux 用户类型

### 2.1 root 用户（超级管理员）

- UID = 0
- 拥有系统最高权限
- 可以执行任何操作

> root 权限 ≠ 安全  
> 滥用 root 是事故源头

---

### 2.2 普通用户

- UID >= 1000（通常）
- 权限受限
- 日常登录、开发、运维使用

---

### 2.3 当前用户查看

```bash
whoami  #当前正在执行命令的用户名
id      #当前用户的完整身份信息（用户名，用户ID（UID），主组ID（GID），所属的所有组）
```

---

## 3. 用户与组（User & Group）

### 3.1 什么是组？

- 一组用户的集合
- 用于批量授权

示例：

- dev 组
- ops 组

---

### 3.2 用户与组关系

- 一个用户 **至少属于一个组**
- 可以属于多个组

---

### 3.3 常用用户与组命令

```bash
useradd user1           #创建用户
passwd user1            #给用户创建密码
groupadd dev            #创建组
usermod -aG dev user1   #将用户追加到组中 -G 指定组 -a 追加
```

---

## 4. 文件权限详解（重点）

### 4.1 权限表示方式

```bash
-rwxr-xr--
```

拆解说明：

| 位 | 含义 |
| --- | --- |
| 前缀 | 文件类型 |
| rwx | 所有者 |
| r-x | 所属组 |
| r-- | 其他用户 |

---

### 4.2 文件类型标识

| 符号 | 类型 |
| --- | --- |
| - | 普通文件 |
| d | 目录 |
| l | 软链接 |

---

## 5. rwx 权限的真实含义

### 5.1 对文件的含义

| 权限 | 含义 |
| --- | --- |
| r | 读取内容 |
| w | 修改内容 |
| x | 执行文件 |

---

### 5.2 对目录的含义（重点）

| 权限 | 含义 |
| --- | --- |
| r | 查看目录列表 |
| w | 创建 / 删除文件 |
| x | 进入目录 |

📌 教学重点：
> 目录没有 x 权限，**连 cd 都进不去**

---

## 6. chmod：修改权限

### 6.1 数字法（推荐）

```bash
chmod 755 file
```

数值含义：

- r = 4
- w = 2
- x = 1

---

### 6.2 数值组合表

| 数值 | 权限 |
| --- | --- |
| 7 | rwx |
| 6 | rw- |
| 5 | r-x |
| 4 | r-- |

---

### 6.3 符号法

基本语法

```bash
#chmod [对象][操作][权限] 文件
chmod u+x file  #用户添加执行权限
chmod g-w file  #组删除修改权限
chmod o=r file  #其他人设置为只读权限
```

---

## 7. chown：修改所属关系

```bash
chown user file        #修改用户
chown user:group file  #修改用户和组
chown :group file      ##修改组
```

递归修改：

```bash
chown -R user:group dir
```

---

## 8. sudo（生产环境重点）

### 8.1 sudo 是什么？

sudo = **Superuser Do**

允许普通用户 **临时以 root 身份执行命令**

---

### 8.2 使用方式

```bash
sudo systemctl restart nginx  #重启nginx服务
```

---

### 8.3 为什么不用 root？

- 操作可审计
- 降低误操作风险
- 更安全

📌 生产环境原则：
> **禁止直接使用 root 登录**

---

## 9. 常见错误

- chmod 给目录忘记 x
- 所有文件 777（危险）
- 用 root 执行所有操作
- chown 用错路径

---

## 10. 本章小结

你现在应该能够：

- 区分 root 与普通用户
- 理解用户与组的关系
- 读懂并设置 rwx 权限
- 正确使用 sudo

---

## 11. 教学练习

### 练习 1

- 创建新用户
- 设置密码
- 切换用户

### 练习 2

- 创建目录
- 设置 755 / 700 权限
- 测试访问效果

---
